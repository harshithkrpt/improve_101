<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="
       http://www.liquibase.org/xml/ns/dbchangelog
       http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.21.xsd">

    <changeSet id="1" author="harshith">
       
        <createTable tableName="categories">
            <column name="id" type="INT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(100)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>

       
        <createTable tableName="roles">
            <column name="id" type="INT">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(100)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>

       
        <createTable tableName="users">
            <column name="id" type="INT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="first_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="last_name" type="VARCHAR(255)">
                <constraints nullable="true"/>
            </column>
            <column name="email" type="VARCHAR(255)">
                <constraints nullable="true" unique="true"/>
            </column>
            <column name="registration_date" type="DATE">
                <constraints nullable="true"/>
            </column>
            <column name="username" type="VARCHAR(100)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="password" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="enabled" type="BOOLEAN" defaultValueBoolean="true">
                <constraints nullable="false"/>
            </column>
        </createTable>

        
        <createTable tableName="user_roles">
            <column name="user_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="role_id" type="INT">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addPrimaryKey tableName="user_roles"
                       columnNames="user_id,role_id"
                       constraintName="pk_user_roles"/>

       
        <createTable tableName="products">
            <column name="id" type="INT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="category_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="price" type="DECIMAL(10,2)">
                <constraints nullable="false"/>
            </column>
            <column name="stock" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="is_active" type="BOOLEAN" defaultValueBoolean="true">
                <constraints nullable="false"/>
            </column>
            <column name="product_image" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>

       
        <createTable tableName="orders">
            <column name="id" type="INT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="user_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="ordered_at" type="DATE">
                <constraints nullable="false"/>
            </column>
            <column name="total_amount" type="DECIMAL(10,2)">
                <constraints nullable="false"/>
            </column>
            <column name="payment_status" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>

       
        <createTable tableName="order_items">
            <column name="id" type="INT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="product_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="order_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="price" type="DECIMAL(10,2)">
                <constraints nullable="false"/>
            </column>
            <column name="quantity" type="INT">
                <constraints nullable="false"/>
            </column>
        </createTable>

        
        <createTable tableName="product_reviews">
            <column name="id" type="INT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="rating" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="review" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="user_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="product_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="reviewed_at" type="DATE">
                <constraints nullable="false"/>
            </column>
        </createTable>

        
        <createTable tableName="payments">
            <column name="id" type="INT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="order_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="method" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="paid_at" type="DATE">
                <constraints nullable="false"/>
            </column>
        </createTable>

      
        <createTable tableName="deliveries">
            <column name="id" type="INT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="order_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="VARCHAR(255)"/>
            <column name="zipcode" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="address" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="landmark" type="VARCHAR(255)"/>
            <column name="courier_name" type="VARCHAR(255)"/>
            <column name="expected_delivery" type="DATE"/>
            <column name="delivered_at" type="DATE"/>
        </createTable>

       
        <addForeignKeyConstraint baseTableName="products"
                                 baseColumnNames="category_id"
                                 referencedTableName="categories"
                                 referencedColumnNames="id"
                                 constraintName="fk_products_categories"/>

        <addForeignKeyConstraint baseTableName="user_roles"
                                 baseColumnNames="user_id"
                                 referencedTableName="users"
                                 referencedColumnNames="id"
                                 constraintName="fk_user_roles_user"/>
        <addForeignKeyConstraint baseTableName="user_roles"
                                 baseColumnNames="role_id"
                                 referencedTableName="roles"
                                 referencedColumnNames="id"
                                 constraintName="fk_user_roles_role"/>

        <addForeignKeyConstraint baseTableName="orders"
                                 baseColumnNames="user_id"
                                 referencedTableName="users"
                                 referencedColumnNames="id"
                                 constraintName="fk_orders_users"/>

        <addForeignKeyConstraint baseTableName="order_items"
                                 baseColumnNames="product_id"
                                 referencedTableName="products"
                                 referencedColumnNames="id"
                                 constraintName="fk_order_items_product"/>
        <addForeignKeyConstraint baseTableName="order_items"
                                 baseColumnNames="order_id"
                                 referencedTableName="orders"
                                 referencedColumnNames="id"
                                 constraintName="fk_order_items_order"/>

        <addForeignKeyConstraint baseTableName="product_reviews"
                                 baseColumnNames="user_id"
                                 referencedTableName="users"
                                 referencedColumnNames="id"
                                 constraintName="fk_product_reviews_user"/>
        <addForeignKeyConstraint baseTableName="product_reviews"
                                 baseColumnNames="product_id"
                                 referencedTableName="products"
                                 referencedColumnNames="id"
                                 constraintName="fk_product_reviews_product"/>

        <addForeignKeyConstraint baseTableName="payments"
                                 baseColumnNames="order_id"
                                 referencedTableName="orders"
                                 referencedColumnNames="id"
                                 constraintName="fk_payments_order"/>

        <addForeignKeyConstraint baseTableName="deliveries"
                                 baseColumnNames="order_id"
                                 referencedTableName="orders"
                                 referencedColumnNames="id"
                                 constraintName="fk_deliveries_order"/>
    </changeSet>
</databaseChangeLog>
