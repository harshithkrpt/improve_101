---

## 1) MTU (Maximum Transmission Unit)

![Image](https://www.imperva.com/learn/wp-content/uploads/sites/13/2022/08/MTU-image-1.png)

![Image](https://networkdirection.net/wp-content/uploads/Theory/MTU_MSS.png)

![Image](https://packetpushers.net/wp-content/uploads/2019/11/IPv4-Headers-Standard-Fragmentation-Highlighted-1024x431.png)

**MTU = biggest payload a link-layer frame can carry.**
On Ethernet, this is usually **1500 bytes** (payload only, not counting Ethernet headers).

Think of MTU as the *road width*. If your truck (IP packet) is wider than the road, it gets chopped up.

### Why MTU matters for performance

* **Too large** â†’ fragmentation (extra packets, extra CPU, higher loss probability).
* **Too small** â†’ more packets â†’ more headers â†’ worse throughput.

### Fragmentation cost

* Fragment loss = entire IP packet wasted.
* Routers doing fragmentation = slow path.
* Reassembly happens **only at destination**, not mid-network.

ğŸ‘‰ Modern networks *hate* fragmentation.

---

## 2) MSS (Maximum Segment Size)

![Image](https://www.cisco.com/c/dam/en/us/support/docs/ip/transmission-control-protocol-tcp/200932-Ethernet-MTU-and-TCP-MSS-Adjustment-Conc-00.png)

![Image](https://networkdirection.net/wp-content/uploads/Theory/MTU_MSS.png)

![Image](https://lostintransit.se/wp-content/uploads/2024/08/TCP_3-way_handshake.drawio.png)

**MSS = max TCP payload per segment (application data only).**
Itâ€™s derived from MTU, not independent.

### The math (classic Ethernet)

```
MTU            = 1500
IP header      = 20 bytes
TCP header     = 20 bytes
-------------------------
MSS            = 1460 bytes
```

### How MSS is decided

* Exchanged during **TCP 3-way handshake**
* Each side says: â€œPlease donâ€™t send me more than this.â€

### Performance angle

* Larger MSS â†’ fewer packets â†’ fewer ACKs â†’ better throughput.
* Smaller MSS â†’ safer across weird paths, but more overhead.

MSS is TCP being polite so IP doesnâ€™t have to get violent (fragmentation).

---

## 3) PMTUD (Path MTU Discovery)

![Image](https://documentation.nokia.com/acg/23-7-2/books/md-cli-part-i/graphics/145-pmtud/ti026371.png)

![Image](https://www.cisco.com/c/dam/en/us/support/docs/ip/generic-routing-encapsulation-gre/25885-pmtud-ipfrag-12.png)

![Image](https://www.cisco.com/c/dam/en/us/support/docs/ip/generic-routing-encapsulation-gre/25885-pmtud-ipfrag-13.png)

**PMTUD = finding the smallest MTU along the entire path.**

The Internet is not one road; itâ€™s many roads stitched together. PMTUD asks:

> â€œWhatâ€™s the narrowest bridge between me and you?â€

### How it works (classic PMTUD)

1. Sender sets **DF (Donâ€™t Fragment)** bit on IP packets.
2. Router hits a smaller MTU link.
3. Router drops packet + sends **ICMP: Fragmentation Needed**.
4. Sender lowers packet size and retries.
5. Repeat until it fits everywhere.

### Performance win

* Zero fragmentation.
* Optimal packet size for that path.
* Stable throughput, lower latency.

### Performance failure mode: *PMTUD Black Holes*

* ICMP blocked by firewalls.
* Sender never learns MTU.
* Large packets keep getting dropped.
* TCP stalls mysteriously.

This is why some stacks use **PLPMTUD (Packetization Layer PMTUD)**â€”probing at TCP level without relying on ICMP.

---

## 4) How they fit together (mental model)

![Image](https://www.cisco.com/c/dam/en/us/support/docs/ip/generic-routing-encapsulation-gre/25885-pmtud-ipfrag-12.png)

![Image](https://www.networkstraining.com/wp-content/uploads/2025/05/2025-05-05-Comparison-of-MTU-vs-MSS-in-Computer-IP-Networks-4-j.jpg)

* **MTU** â†’ physical/link constraint
* **MSS** â†’ TCPâ€™s promise to stay within MTU
* **PMTUD** â†’ runtime discovery of *real* MTU across the Internet

Formula worth remembering:

```
Effective MSS = Path MTU âˆ’ IP header âˆ’ TCP header
```

---

## 5) Real-world performance implications

### High throughput (datacenters, CDNs)

* Jumbo frames (MTU 9000) â†’ larger MSS â†’ fewer packets â†’ better CPU efficiency.
* Requires end-to-end support (one small link ruins it).

### VPNs & tunnels

* Encapsulation eats MTU (IPsec, GRE, WireGuard).
* If MSS isnâ€™t clamped â†’ fragmentation or black holes.
* MSS clamping is a quiet hero here.

### Mobile & flaky networks

* Smaller, adaptive MSS performs better than aggressive sizes.
* PLPMTUD shines.

---

## 6) One-sentence intuition

* **MTU**: â€œHow big a box can fit on this road?â€
* **MSS**: â€œHow much stuff Iâ€™ll put in each TCP box.â€
* **PMTUD**: â€œLetâ€™s measure every road before shipping.â€

Networking performance is mostly about *not asking the network to do extra work*. MTU, MSS, and PMTUD are the art of being exactly the right sizeâ€”no more, no less.
