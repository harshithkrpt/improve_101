
# Gmail System Design - Documentation

![System Diagram](./gmail_system_architecture.png)

---

## üìå Key Requirements
- User Registration & Two-Factor Authentication
- Email Send/Receive with Attachment Support
- Keyword-Based Search
- Spam and Virus Detection
- Contact & Group Management

---

## üß± High-Level Components

### 1. Gateway Service
- Entry point for all requests.
- Handles IP blocking and request translation.

### 2. Service Manager
- Registers all services with heartbeat monitoring.
- Routes external/internal requests.

### 3. Authentication Service
- Handles login, registration, and 2FA validation.

### 4. Message Service
- Sends OTP via email/SMS.
- Stores message templates.

### 5. Profile Service
- Manages user profiles and profile pictures.

### 6. Email Service
- Sends and receives emails.
- Publishes to message queue.

### 7. Message Queue
- Enables asynchronous processing for services like spam, search, and preferences.

### 8. Search Engine
- Uses inverted index for keyword-based email search.

### 9. Spam Detector
- Classifies email based on subject, content, and frequency.

### 10. Virus Detector
- Scans attachments for malware.

### 11. Distributed File Service
- Stores and serves email attachments.

### 12. Contacts Manager
- Maintains mappings of senders and receivers for contacts and groups.

### 13. IMAP & SMTP Servers
- Handles external communication.

---

## ‚öôÔ∏è Design Trade-offs

| Component           | Decision                                    | Reason                                                                 |
|--------------------|---------------------------------------------|------------------------------------------------------------------------|
| Service Registry    | Use service manager                         | Reduces gateway load, improves modularity                             |
| Token Storage       | Use distributed cache                       | Avoids cache duplication and update fan-out in memory                 |
| Spam/Virus Checking | Asynchronous via message queue              | Scalability and fault isolation                                       |
| Attachments Storage | Distributed file system                     | Redundancy and fast retrieval                                         |

---

## üìä Capacity Estimation

### Storage Per Day
- **Emails**: ~20TB
- **Attachments**: ~5PB
- **Total (3x redundancy)**: ~15PB ‚Üí Optimized to ~4.5PB with de-duplication and compression

### Profile Storage
- Without images: ~100GB
- With images: ~20TB ‚Üí Total with redundancy: ~60TB

### Processing Power (Per Day)
- **Virus Checker**: Needs ~6000 parallel processes
- **Spam Detector**: Needs ~24 processes

### Cache for Contacts
- Active users: 20M
- Estimated cache: 200GB ‚Üí ~120 machines (with redundancy and locality)

---

## ‚úÖ API Contracts Summary

See PDF for full API contract list (Auth, Profile, Email, Contacts, Drive, Search Engine).

---

*Generated by ChatGPT*
