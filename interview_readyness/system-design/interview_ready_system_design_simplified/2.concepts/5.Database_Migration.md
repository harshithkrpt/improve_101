# Database Concepts and Migration

---

## 1. Primary Replica

A **Primary Replica** is the main copy of a database in a replication setup. It:
- Handles all write operations.
- Propagates changes to secondary (replica) databases.
- Ensures high availability and fault tolerance.

Used in:
- Master-slave replication setups.
- Failover and disaster recovery scenarios.

---

## 2. WAL (Write-Ahead Logging) and Change Data Capture (CDC)

### WAL
- **Write-Ahead Logging** ensures that changes are logged before being applied to the database.
- Used for crash recovery and durability in databases like PostgreSQL and MySQL (InnoDB).

### Change Data Capture
- A technique for tracking changes in a database.
- Often implemented using:
  - Triggers
  - WAL logs
  - Transaction logs
- Essential for syncing data between systems or during migration.

---

## 3. Write Amplification and Split Brain Problem

### Write Amplification
- Occurs when a small logical write causes multiple physical writes.
- Common in:
  - SSDs (due to block erasure)
  - LSM-based databases (e.g., RocksDB)

**Impact:** Reduces write performance and lifespan of storage media.

### Split Brain
- Happens when a distributed system has multiple nodes acting as the leader or primary due to network partition.
- Leads to:
  - Inconsistent data
  - Conflicting updates

**Prevention:**
- Quorum-based decision-making
- Consensus protocols (like Raft, Paxos)

---

## 4. Database Migrations

### Brute Force Approach
1. Stop the existing DB.
2. Fail all incoming requests (notify users beforehand).
3. Take a data dump and load it into the new DB.
4. Restart services pointing to the new DB.

### Optimised Approach
1. Use Change Data Capture (CDC).
2. Copy older records to new DB.
3. Use a proxy to serve clients via old DB.
4. Point proxy to new DB.
5. Migrate clients to new DB.
6. Remove the proxy.

**Recommendation:** Always validate data correctness and communicate with users during migration.

---

## 5. Migration Across Regions

- Involves moving data between geographically distributed data centers.
- Challenges:
  - Latency
  - Data consistency
  - Time zone handling
  - Legal/data sovereignty compliance

**Strategies:**
- Use globally distributed databases (e.g., Spanner, Cosmos DB)
- Use replication with eventual consistency
- Schedule downtime windows (if acceptable)
- Ensure transactional guarantees if needed via custom reconciliation logic

